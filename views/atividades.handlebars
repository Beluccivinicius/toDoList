<body>
<head>
    <h1>toDo list</h1>
</head>
<div class="container">
    <form  action="/atividades" method="POST" id="post" name="principal">
        <div>
            <label>O que vamos fazer?</label>
            <input type="text" class="text" name="oQueFazer" id="toDo">
        </div>
        <div>
            <label>Hora</label>
            <input type="time" name="horaCerta" id="time">
        </div>
        <div>
            <label>Dia</label>
            {{!-- a propriedade name especifica no corpo da minha requisição o que é cada input --}}
            <input type="date" name="dataCerta" id="date">
        </div>
    </form>
    <div id="post">
            <input type="submit" class="button" value="POST" id="posted">
    </div>
</div>
    <ul class="list-group">
        {{#each toDo}}
            <li class="boxToDo" id="boxToDo">
                <div id="check">
                    <a></a>
                        <button type="button" class="exclusion" value="{{this._id}}" id="exclusion-{{this._id}}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 23 19" fill="none" type="submit" value="{{this._id}}">
                                <rect x="2.53418" width="25" height="4" rx="2" transform="rotate(37 2.53418 0)" fill="#D9D9D9"/>
                                <rect y="15.2028" width="25" height="4" rx="2" transform="rotate(-37 0 15.2028)" fill="#D9D9D9"/>
                            </svg>
                        </button>
                </div>
                    <div id="do-hour">
                        <span>{{this.oQueFazer}}</span>
                        <br>
                        <span id="hora">{{this.horaCerta}}</span>
                    </div>
                    <div id="day">
                        <span id="dia">dia {{this.dia}}/{{this.mes}}<span> 
                    </div>
            </li>
        {{/each}}
    </ul>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const btn = document.getElementsByClassName('exclusion');
const btnPost = document.getElementById('posted')

const deleted = (id) => {
    axios
        .delete(`http://localhost:8000/atividades/${id}`, {
            _id: id
        })
        .then((res) => console.log(res))
        .catch((error) => {
            if (error.request) {
                console.log('sem resposta servidor');
            } else if (error.response) {
                console.log('Erro de resposta do servidor');
            } else {
                console.log('Erro ao fazer a solicitação');
            }
        });
};

function handleClick(event) {
    const id = event.target.value;
    deleted(id)
}

for (let i = 0; i < btn.length; i++) {
    btn[i].addEventListener('click', handleClick);


const posted = (oQueFazer, dataCerta, horaCerta) => {
    axios
        .post('http://localhost:8000/atividades',{
            oQueFazer,
            dataCerta,
            horaCerta
    })
    .then(res => console.log(res))
    .catch(err => console.log(err))
}

btnPost.addEventListener('click', function(e) {
    e.preventDefault();
    const form = document.getElementById("post")
    const formData = new FormData(form)
    const formDataValues = [...formData]
    const [oQueFazer, horaCerta, dataCerta] = formDataValues
    posted(oQueFazer[1], dataCerta[1], horaCerta[1])
    location.reload();
})
</script>


